package com.changjinxiong.deepneuralnets.test;

import static org.junit.Assert.*;

import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Image;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import java.awt.image.WritableRaster;
import java.io.File;
import java.io.IOException;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;

import org.junit.Test;

import com.changjinxiong.deepneuralnets.nn.ConvolutionalLayer;
import com.changjinxiong.deepneuralnets.nn.ConvolutionalNeuralNetwork;
import com.changjinxiong.deepneuralnets.nn.FullyConnectedLayer;
import com.changjinxiong.deepneuralnets.nn.Layer;
import com.changjinxiong.deepneuralnets.nn.MultiLayerPerceptron;
import com.changjinxiong.deepneuralnets.nn.NeuralNetwork;
import com.changjinxiong.deepneuralnets.nn.PoolingLayer;
import com.changjinxiong.deepneuralnets.nn.PoolingLayer.PoolingType;
import com.changjinxiong.deepneuralnets.nn.Util.ActivationType;
import com.changjinxiong.deepneuralnets.test.CIFAR10DataProvider.DatasetType;

public class TestCIFAR {
	int interval = 1500;

	@Test
	public void testCIFAR10DataProvider() {
		JFrame frame = new JFrame();
		frame.setMinimumSize(new Dimension(384, 384));
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.getContentPane().setLayout(null);
        JLabel imageLabel = new JLabel();
        JLabel type = new JLabel("!!!!");
		frame.getContentPane().add(imageLabel);
		frame.getContentPane().add(type);
		imageLabel.setBounds(128, 80, 128, 128);
		type.setBounds(128, 208, 120, 16);
		imageLabel.setVisible(true);
		type.setVisible(true);
		frame.getContentPane().setVisible(true);
		frame.setVisible(true);
		CIFAR10DataProvider cp = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", 1, DatasetType.TRAINING_ALL, false, false);
		int width = 32;
		int height = 32;
		String[] labels= {"airplane", 
				"automobile",
				"bird",
				"cat",
				"deer",
				"dog",
				"frog",
				"horse",
				"ship", 
				"truck"};
		
		for (int i = 0; i < cp.getDatasetSize(); i ++) {
			float[] floatPixels = cp.getNextbatchInput();
//			double[] floatPixels = {23.2893, -4.14037, -26.0504, -29.5689, -7.18469, 22.1482, 38.6285, 46.1091, 7.51495, -23.9326, -29.234, -26.4037, -12.6202, -8.63419, 45.366, 81.3886, 73.4695, 30.4964, 28.509, 22.6165, -19.1096, -32.9583, -39.8102, -44.5266, -62.0462, -73.6069, -77.0759, -55.3248, -37.5888, -40.059, -43.3931, -51.174, 9.9007, 15.6554, -5.2169, -6.5724, 18.8458, 20.1777, 41.6399, 45.1596, 0.607666, -23.8755, -1.26447, 28.5847, 57.3613, 83.337, 105.359, 110.543, 106.593, 103.513, 99.5326, 91.6034, 7.84546, -38.0784, -34.8882, -38.5548, -43.9674, -52.5395, -66.9404, -47.1943, -38.5414, -34.0425, -52.3304, -58.1568, 10.2753, 10.2834, -14.4735, 17.1472, 7.63844, 1.03944, 38.5186, 45.9982, 38.3483, 58.8674, 85.4502, 100.225, 95.1457, 105.121, 110.209, 112.38, 98.3334, 91.2532, 101.318, 109.501, 43.743, -32.155, -32.0029, -44.622, -29.0397, -37.5621, -66.0204, -47.4232, -39.8321, -50.2107, -60.5909, -61.5913, 6.53806, 8.62764, -7.05286, 2.49387, 21.1274, 50.6845, 72.1843, 76.551, 75.8367, 70.3338, 45.9904, 35.7907, 30.8539, -8.22543, 44.7717, 106.968, 97.9492, 77.8941, 62.0123, 68.1746, 50.4693, -11.318, -41.2359, -37.8846, -40.3713, -53.9019, -61.3678, -32.9241, -41.4523, -52.8304, -64.2162, -57.3197, -0.201447, 12.9407, 7.37192, 56.9476, 85.7247, 72.2746, 33.7692, 19.2145, 6.58305, -12.8225, -38.2745, -24.5331, -24.4242, -100.452, -2.48814, 108.713, 103.759, 102.683, 78.6847, 62.9119, 1.33282, -6.3998, -29.2534, -32.9785, -42.6182, -50.2548, -39.7783, -35.3399, -59.9286, -57.4043, -59.9097, -41.0466, 7.09386, 8.2703, -1.11824, 24.5613, 9.38351, -9.03523, -36.4755, -31.8776, -27.4613, -34.9293, -45.4128, -12.7071, -34.5502, -85.5831, -14.6233, 71.5584, 96.6321, 101.484, 104.404, 105.613, 33.9262, -4.79063, -6.5732, -38.2177, -41.9505, -51.7501, -42.2972, -30.8076, -52.4239, -60.956, -46.5288, -36.7188, 17.5136, -3.2023, -39.5193, -42.7071, -40.9532, -44.2715, -53.6865, -51.0467, -60.6004, -77.1503, -90.6005, -76.8027, -65.6437, -45.6547, -13.7336, 13.3692, 44.4811, 82.3507, 101.268, 108.424, 49.607, -2.10139, -14.777, -46.4748, -55.226, -58.0692, -42.7139, -42.2247, -37.8525, -44.4178, -50.0325, -46.3172, 34.0049, -16.598, -63.8659, -53.9925, -69.1542, -81.5778, -80.9655, -97.1595, -113.646, -110.265, -90.6833, -66.7618, -37.62, -8.73827, -41.8481, -9.75677, 9.2011, 24.0122, 68.9829, 105.204, 79.443, 62.6017, 16.901, -20.898, -27.5315, -29.2989, -31.085, -54.6612, -48.2893, -32.8291, -43.5338, -52.8835, -0.45488, -55.961, -89.2252, -92.291, -79.4581, -41.8843, 1.75612, -23.3087, -54.7113, -34.3276, -3.70442, 9.12663, -13.9324, -9.10684, -71.2529, -62.3737, -21.5096, 47.398, 58.4012, 103.576, 78.9833, 20.2163, 54.3565, 40.5097, -15.1793, -38.8936, -43.5872, -62.2384, -70.7697, -38.275, -44.9728, -63.4166, -56.2284, -51.6875, -53.813, -44.8534, -4.068, 34.588, 31.1988, 1.14116, -34.2196, -29.7562, -0.144302, 4.53925, -24.7482, -9.94579, -75.08, -92.1952, -54.3607, 62.6402, 96.5426, 102.634, 70.0932, -19.5037, 19.8226, 63.9858, 30.1778, -23.6372, -58.2777, -51.9227, -46.385, -37.8647, -58.562, -70.1218, -77.9714, -27.4094, -20.4941, -2.56512, 22.2268, 16.7896, -12.5671, -18.7919, -32.0636, -26.3533, -2.93954, -0.330353, -27.5171, -10.8196, -63.0398, -94.209, -52.2378, 60.7086, 96.588, 102.727, 82.1194, 12.5962, 28.0659, 66.2889, 75.557, 46.7791, -30.9408, -54.4681, -23.9212, -26.4126, -32.1433, -46.7896, -67.6777, -21.9761, -36.0584, -13.1556, 12.5082, 3.88516, -3.47736, -5.63314, -18.7897, -20.0988, -10.7788, -3.24838, -25.5933, -12.9819, -51.2137, -88.4717, -49.4726, 59.5364, 94.5084, 103.816, 84.2742, 17.7368, 37.0597, 62.4178, 56.7661, 66.1065, 48.4282, -3.04238, -14.4111, -21.9498, -32.7742, -30.4704, -42.3556, -20.603, -43.593, -35.6506, -7.0683, -12.8527, -12.3618, -21.5733, -26.7097, -23.1875, -14.9491, 6.40486, -3.98578, -5.32596, -57.5716, -87.7903, -40.8821, 61.1776, 92.2495, 100.574, 86.2049, 16.6381, 24.9379, 63.3216, 63.6986, 52.2074, 57.6678, 59.2429, 20.9826, -22.5346, -44.515, -39.2156, -42.8943, -25.0772, -53.13, -36.3555, -19.8612, -26.685, -37.2055, -32.5282, -19.8992, 0.423439, 13.62, 33.8754, 30.5226, 21.3044, -23.9485, -65.0785, -41.114, 57.8641, 89.9545, 97.281, 86.7164, 32.214, 30.7613, 60.1837, 75.7801, 70.4003, 54.91, 54.7198, 69.4827, 37.9474, -38.1222, -59.9167, -42.632, -20.6055, -37.7187, -7.13396, 32.1955, 43.5125, 46.0213, 34.502, 25.8197, 34.202, 72.5698, 100.96, 102.449, 90.1885, 50.063, 15.0636, 29.037, 75.9618, 93.953, 95.1391, 85.5341, 40.2344, 36.9879, 62.6533, 81.2726, 68.9231, 74.5891, 63.3983, 59.0537, 65.4107, 42.3406, -38.6508, 20.3658, 56.4944, 30.5242, 57.2404, 94.6637, 118.052, 120.393, 106.649, 99.1816, 99.6692, 111.165, 122.608, 125.006, 107.788, 41.6637, 65.8267, 97.7816, 92.6556, 93.5741, 90.6938, 85.2261, 43.9865, 36.5996, 61.337, 84.0222, 70.665, 75.3456, 57.1258, 61.6186, 62.9498, 63.8894, 21.6769, 71.482, 116.72, 107.952, 118.873, 116.506, 117.925, 123.177, 125.476, 124.189, 125.6, 123.001, 119.507, 122.931, 101.671, 77.7353, 87.012, 90.0569, 89.038, 89.0459, 88.2116, 84.6154, 42.2615, 35.8053, 56.4373, 82.196, 73.7721, 78.4748, 45.1642, 14.4715, 73.6121, 63.3061, 31.87, 80.6899, 129.165, 128.674, 128.879, 126.594, 127.092, 128.284, 125.603, 123.302, 122.822, 123.317, 116.901, 122.407, 102.035, 91.2756, 87.5401, 88.7853, 88.9726, 88.0269, 90.1289, 86.3828, 40.7918, 36.2655, 57.7957, 84.5304, 82.1504, 87.7559, 57.294, 14.4505, 53.3656, 80.8282, 42.24, 93.8126, 128.595, 119.486, 118.912, 111.787, 100.346, 93.6039, 85.9222, 81.4931, 76.138, 70.8168, 60.413, 50.1554, 45.8242, 59.0419, 72.2833, 88.5351, 96.7658, 93.8556, 93.9423, 90.1921, 55.4122, 36.8639, 51.2731, 83.9305, 84.5716, 87.1187, 72.4637, 46.4198, 45.0563, 80.2385, 57.4062, 13.9519, 13.9562, -1.8579, -13.2626, -11.076, -18.2889, -41.9277, -45.5012, -28.0717, -11.324, -4.59892, -16.0113, -54.1912, -68.2701, -39.11, -35.9377, -21.7597, 11.3586, 39.4077, 72.566, 90.8167, 69.9829, 55.3438, 55.7646, 80.3184, 83.8639, 89.3632, 96.4642, 81.1602, 75.603, 83.5129, 75.4623, -55.0644, -35.7565, -35.3838, -83.5798, -52.206, -32.0989, -67.5747, -72.1289, -34.673, -15.8735, -32.9726, 33.7425, 33.4947, 23.4013, 25.5958, -7.18242, -45.176, -65.2515, -49.0597, 34.0185, 93.1052, 77.3377, 84.7244, 79.0571, 82.4126, 82.6874, 85.1854, 92.216, 88.876, 90.1093, 86.6442, 80.4437, 29.8464, 40.4457, 31.9507, -71.1277, -26.5788, -24.2989, -57.551, -64.0136, 4.58894, 21.4147, 11.1886, 111.134, 121.049, 109.876, 108.092, 104.326, 96.1938, 74.1061, 43.3028, 53.2671, 70.1889, 38.5043, 40.8028, 7.06312, 61.3246, 92.4977, 87.899, 95.0121, 92.5142, 92.3693, 88.5878, 86.166, 36.8832, 2.5672, -9.83104, -71.7984, -31.1318, -42.689, -55.6703, -54.8855, 0.842377, 7.56488, -15.681, 39.309, 22.3112, 7.25212, 20.379, 35.5141, 46.4384, 18.3635, 40.3448, 62.2159, 10.1476, -7.60918, -10.3895, -46.0415, -19.8283, 17.3117, 32.5132, 47.5822, 55.8138, 69.3988, 72.5696, 80.0739, 23.7608, -63.7229, -91.0936, -87.818, -77.0146, -76.4479, -80.2338, -80.2887, -67.4767, -61.7647, -13.9419, 34.0802, 9.06342, -25.8469, -44.7451, -50.7507, -76.8481, -109.943, -58.0001, 52.0195, -42.9007, -46.8224, -60.6794, -69.4556, -79.2711, -80.1729, -69.0457, -64.1761, -62.0876, -50.5946, -24.5204, 52.0222, 48.505, -27.1103, -63.3272, -57.9789, -53.9999, -51.4, -52.1027, -46.0839, -46.2219, -20.5188, 50.3376, 63.4678, 49.5682, -32.3114, -82.1802, -58.2104, -84.2619, -106.271, -101.302, 10.6691, -32.1723, -58.2181, -43.2828, -38.3285, -28.2016, -46.1291, -65.029, -85.4411, -94.3907, -100.924, -77.7955, 30.8684, 30.2963, 28.5643, 32.2504, 40.6937, 45.8503, 48.4917, 46.7741, 49.8242, 44.6702, 35.4648, 31.42, 32.5523, 14.739, -66.0647, -107.776, -69.8666, -83.9141, -104.846, -106.897, -58.218, -27.1514, -29.2575, -21.4934, -11.5739, -18.5206, -62.5082, -53.5073, -69.0324, -94.071, -81.5682, -88.2479, -35.3164, 41.1758, 25.1507, -19.3753, 3.98542, 28.1875, 23.8718, 7.16358, 7.27788, 11.1579, 38.0465, 64.107, 37.4098, 3.67744, -44.0781, -55.9207, -53.0359, -80.1418, -80.196, -104.184, -78.4373, -33.5553, -32.7604, -34.0391, -22.2004, -27.1332, -56.1912, -47.32, -75.8877, -95.0064, -59.3672, -66.8427, -36.6316, 48.0559, 17.7104, -77.9855, -77.8055, -62.8433, -67.2708, -74.98, -70.8955, -39.8771, 54.1727, 98.2965, 47.7452, -20.756, -38.5276, -21.562, -42.556, -35.7194, 7.1591, -80.8582, -75.0374, -39.2857, -45.6644, -47.1175, -35.243, -32.2087, -25.3334, -47.6423, -77.1276, -87.1321, -19.1768, -28.4244, -0.908257, 37.7517, 17.1471, -7.88676, -8.93528, -5.22446, -6.88074, -7.65452, -4.54612, 3.62174, 28.7058, 39.9128, 22.3847, -21.1641, -78.9588, -97.9045, -63.8754, -11.0778, -0.192337, -73.318, -74.6594, -50.9855, -49.3429, -51.5811, -45.7986, -41.9416, -2.99408, -35.2579, -36.649, -91.3334, -46.1184, -56.0198, -31.2559, 48.4463, 31.4116, 30.0749, 23.7403, 32.1172, 38.3217, 37.5231, 44.544, 42.5932, 29.621, 40.8844, 42.2986, 11.5632, -60.3421, -81.2693, -61.2547, -40.2429, -21.3108, -56.4786, -62.7763, -60.122, -71.377, -78.5013, -83.7266, -79.9315, -20.9448, -68.058, -91.3184, -100.709, -82.2404, -63.689, -32.5167, 37.9319, 30.531, 33.7151, 6.04116, -30.8299, -22.8164, -16.7137, 3.1722, 29.0758, 31.0871, 57.259, 54.505, 0.63208, -41.4041, -36.4435, -61.4286, -81.266, -49.3215, -66.382, -79.6423, -89.922, -104.074, -111.214, -114.331, -111.44, -66.3506, -76.2136, -71.2609, -44.3959, -22.4925, -2.58606, 5.0033, 35.2653, 31.402, 36.1348, 18.1202, -84.0942, -108.326, -107.433, -53.5439, 6.32326, -8.74576, -17.7572, -28.72, -66.695, -100.779, -109.919, -110.902, -102.728, -98.7778, -111.833, -122.95, -122.119, -118.182, -103.14, -77.0022, -59.9012, -37.7712, -11.5215, 6.71678, 12.9366, 16.2216, 16.435, 16.3609, 40.9439, 1.55762, -32.2462, -35.678, -6.22858, 28.1455, 51.7161, 60.2593, 16.7248, -19.6326, -32.941, -36.0906, -19.2688, -11.2617, 47.7746, 85.8279, 70.9067, 26.9386, 24.9465, 20.0391, -22.7138, -38.6188, -44.4984, -50.2973, -68.9465, -78.5873, -81.1072, -59.4154, -40.7739, -41.307, -45.7085, -54.4736, 24.7052, 18.5409, -10.1767, -6.43063, 25.082, 27.5135, 51.1109, 51.7179, 1.26074, -27.1193, -11.4895, 17.3934, 53.1872, 80.1822, 102.248, 107.454, 103.495, 100.459, 96.4878, 88.5147, 4.71286, -41.2882, -37.1658, -41.9297, -48.4783, -56.1335, -69.6023, -49.9791, -40.4965, -36.1386, -54.559, -61.3837, 20.3518, 12.5025, -19.0555, 18.7224, 15.4015, 9.9901, 48.6047, 53.216, 39.6949, 58.3238, 80.9618, 95.7856, 99.7079, 107.686, 106.826, 105.054, 94.0304, 89.0027, 98.0764, 106.179, 40.3524, -34.6446, -33.5919, -47.3223, -32.906, -40.5319, -68.0987, -48.6961, -41.3413, -51.9582, -63.5415, -64.5577, 12.9136, 9.18404, -12.2199, -0.437881, 23.4532, 59.2875, 88.0216, 92.5698, 87.9777, 83.5917, 58.3357, 48.1882, 50.2636, 5.2066, 46.2502, 100.534, 94.5658, 76.5556, 59.6611, 64.7324, 47.9448, -11.9589, -40.9943, -37.7853, -40.4709, -54.1811, -61.8307, -33.6277, -42.438, -55.1329, -66.7837, -59.9538, 3.47774, 13.8549, 6.61438, 53.525, 87.6409, 83.5286, 55.3526, 45.0489, 28.6142, 12.3407, -12.025, 2.77852, 4.92294, -82.0757, 3.9212, 105.209, 101.301, 102.241, 77.2109, 60.3614, 0.69252, -5.14577, -26.1573, -29.0879, -40.9417, -50.8279, -39.6292, -35.4901, -59.3921, -59.2305, -62.0755, -43.3611, 11.0804, 17.5493, 16.572, 40.6524, 28.8789, 9.85233, -16.2013, -13.2427, -11.5412, -15.8074, -24.1769, 10.6011, -13.1617, -73.1448, -10.1563, 74.0872, 99.1627, 103.991, 107.892, 108.061, 38.2575, -6.60976, 0.36824, -29.5338, -44.5113, -55.6295, -45.5353, -32.4341, -54.4101, -62.3547, -48.3205, -38.7099, 21.8138, 7.40749, -21.4095, -25.1221, -19.9144, -26.7801, -39.6977, -37.6232, -44.8142, -58.0143, -69.2255, -50.3389, -41.1327, -36.0612, -12.1019, 15.0237, 48.0784, 86.9066, 105.803, 113.896, 53.932, -8.94553, -11.8998, -37.9307, -59.0035, -62.2618, -45.3403, -45.2899, -40.3729, -45.4293, -51.4579, -47.9687, 40.5986, -4.64, -52.3495, -46.9517, -57.6231, -71.5048, -73.3094, -86.0109, -95.0301, -88.1982, -65.2906, -35.2321, -3.01328, 4.98584, -42.0517, -8.94564, 13.934, 29.7157, 74.633, 111.74, 80.7953, 48.7768, 8.75938, -18.4345, -31.5, -31.7516, -33.0508, -57.127, -50.2675, -33.379, -44.5361, -54.1658, 6.46565, -38.6187, -76.2916, -88.8015, -73.4489, -36.256, 5.02478, -15.4739, -36.3081, -12.4432, 22.572, 41.6081, 24.7201, 4.74884, -71.2797, -56.378, -14.5883, 53.2431, 64.1331, 110.152, 76.3391, -5.651, 33.1265, 36.8634, -17.3256, -40.6053, -45.8901, -65.1187, -73.1748, -37.3042, -44.5565, -63.3342, -54.9271, -29.9451, -34.4739, -39.9002, 2.4502, 40.7691, 33.0871, 8.72148, -13.9836, -5.9722, 27.0809, 39.0553, 13.0408, 0.112602, -72.8433, -76.9111, -43.1771, 68.6951, 103.463, 111.384, 61.5305, -59.4143, -13.5018, 57.1953, 29.7697, -22.6687, -58.9415, -54.2078, -48.2324, -36.4169, -57.769, -69.6809, -83.3278, -5.28758, 2.25976, 5.86804, 32.292, 25.5573, -10.0512, -11.4995, -12.0033, -0.633598, 27.3217, 36.3243, 7.4656, -1.53136, -56.5515, -68.6237, -35.7437, 69.084, 104.794, 110.679, 70.689, -32.2892, -9.30238, 58.3677, 74.9536, 46.4707, -30.9002, -56.0949, -25.2346, -24.4978, -30.9156, -46.0091, -70.6878, -5.47232, -12.8519, 5.79698, 29.1577, 18.3207, 7.75206, 6.38672, -0.907356, 4.56182, 23.5379, 37.5491, 9.5675, 1.54742, -36.4508, -56.5736, -25.6461, 76.2203, 106.957, 108.919, 74.9269, -20.08, 3.7292, 52.4085, 49.0272, 58.6323, 44.2431, -3.0065, -12.1864, -19.5383, -33.0349, -32.2903, -39.9641, -2.66582, -19.8837, -7.13514, 23.225, 15.2829, 13.6139, 2.2634, -0.981377, 9.4005, 27.4073, 52.2781, 29.3256, 11.413, -40.5623, -57.6325, -15.7748, 80.1795, 107.002, 106.923, 81.0632, -15.9764, -6.25494, 51.3222, 51.8955, 38.6031, 48.2479, 54.9552, 19.7665, -22.6091, -46.299, -42.6146, -38.1544, -6.75826, -31.9643, -9.28204, 10.0742, 2.12186, -11.4846, -9.86888, 1.6981, 26.9555, 45.9933, 68.8425, 56.9829, 37.2379, -8.73416, -42.7392, -19.7726, 77.1691, 106.024, 107.947, 86.8632, 2.7467, -0.381737, 47.1737, 61.8912, 53.643, 40.2477, 44.0981, 61.866, 33.3943, -43.4689, -64.9391, -41.6083, -7.95044, -23.1192, 6.47002, 44.7366, 52.9834, 54.4517, 40.9082, 31.2219, 42.5865, 83.8351, 114.88, 119.9, 104.102, 63.2216, 30.3729, 48.4349, 95.3799, 111.095, 109.855, 90.6945, 14.6931, 6.67044, 47.4279, 65.1853, 54.9026, 61.5968, 51.3829, 47.0189, 55.3703, 34.4253, -42.3133, 15.7206, 60.55, 34.5606, 61.2998, 98.7226, 120.129, 119.427, 106.642, 102.173, 104.677, 116.113, 128.263, 134.182, 119.411, 53.5582, 75.8602, 113.892, 111.785, 112.433, 109.08, 95.0211, 21.1206, 7.93428, 43.7668, 70.5547, 64.2282, 67.8772, 47.5963, 50.0507, 50.3325, 55.3324, 19.3252, 62.1239, 114.115, 106.364, 122.317, 122.951, 124.421, 127.659, 131.903, 134.613, 135.023, 133.368, 128.6, 130.554, 113.707, 91.0954, 97.5138, 104.562, 106.537, 107.288, 108.009, 95.8053, 23.7844, 7.56384, 36.3169, 70.1012, 69.6883, 69.3365, 29.9591, -3.76932, 55.3075, 51.0671, 27.7962, 73.5544, 122.792, 126.301, 131.518, 131.254, 132.784, 134.008, 133.262, 130.886, 130.346, 132.723, 130.008, 133.047, 116.104, 108.618, 106.029, 104.304, 104.443, 104.243, 105.907, 94.5548, 29.2818, 9.03152, 33.7528, 69.5371, 67.1893, 63.799, 23.3023, -25.6002, 22.2563, 59.7927, 30.3507, 88.8728, 126.392, 121.282, 121.677, 115.533, 104.127, 99.3849, 92.5647, 88.9993, 84.5211, 79.9532, 70.1855, 59.4245, 57.5415, 76.0315, 91.365, 104.666, 110.846, 108.68, 109.344, 96.034, 43.6102, 8.35246, 26.0229, 68.8253, 68.5872, 62.2114, 37.591, 5.52968, 13.0915, 58.3207, 43.6652, 11.1834, 19.9211, 5.05924, -8.40642, -8.2894, -14.5277, -37.2443, -39.0167, -17.774, 2.74256, 6.08264, -11.7665, -48.4643, -60.1498, -26.7249, -21.5025, -8.3131, 24.7757, 53.5639, 87.326, 94.0733, 52.6531, 24.3764, 30.1366, 66.952, 70.6473, 70.2571, 70.5152, 51.297, 48.6876, 64.6797, 61.8842, -53.6786, -21.678, -22.4229, -78.7157, -49.4812, -29.5218, -64.1585, -66.0033, -19.8283, 5.631, -20.927, 33.3173, 35.4944, 28.7351, 34.1344, 4.39202, -32.5814, -51.6812, -36.7063, 46.9661, 89.596, 52.3428, 50.2113, 52.9947, 69.6933, 70.1913, 69.8505, 74.1064, 67.9, 68.1348, 68.8507, 65.986, 35.3687, 61.5854, 50.8972, -65.3746, -25.0353, -21.9906, -55.5168, -57.3591, 24.8773, 50.2778, 26.5224, 106.965, 120.256, 113.387, 114.756, 113.998, 109.88, 87.7712, 54.8085, 64.4204, 61.9349, 9.83362, 1.68306, -22.5637, 47.1404, 78.6372, 75.2967, 82.6709, 78.3511, 74.314, 72.7864, 70.7625, 41.4399, 21.7033, 9.05124, -66.1948, -30.8368, -41.7297, -54.0864, -49.7475, 15.5522, 29.784, -3.09806, 36.343, 23.6937, 11.8788, 26.1427, 43.338, 57.2648, 29.1664, 49.027, 68.5984, -6.83888, -43.9935, -50.1751, -74.2845, -33.5481, 7.01356, 20.5678, 36.9709, 45.453, 54.2756, 59.7612, 66.7193, 22.3498, -57.5813, -79.2684, -82.3726, -76.9739, -74.8655, -78.0921, -76.6404, -60.3434, -55.1836, -6.02436, 42.3732, 16.6411, -18.1214, -36.8916, -44.7709, -68.8491, -100.975, -52.1445, 54.5596, -62.7411, -77.9704, -85.1191, -85.3053, -85.5542, -84.936, -81.362, -76.0669, -70.6209, -61.8419, -33.3851, 46.6499, 45.1276, -26.0095, -55.6438, -51.7716, -49.2564, -45.1677, -46.3671, -37.8883, -32.6226, -6.5164, 64.6564, 75.0841, 50.3874, -27.377, -73.1097, -46.018, -70.0668, -92.0931, -90.255, 16.4372, -30.7537, -57.0411, -41.3433, -35.7385, -23.9906, -48.3277, -75.6849, -96.601, -101.132, -105.31, -80.7288, 30.4654, 23.9062, 28.5919, 38.7669, 47.6744, 52.2796, 55.3874, 55.1086, 55.5539, 49.7829, 43.9601, 36.1803, 28.5431, 8.91656, -63.7408, -95.3092, -51.3172, -63.4008, -86.3593, -90.538, -47.0773, -12.2868, -13.5957, -12.0809, -7.52186, -15.7983, -63.1383, -63.4949, -78.5068, -97.0612, -79.0771, -86.2474, -32.7345, 33.7671, 23.1144, -15.9848, 7.76474, 31.3427, 27.4468, 11.1242, 3.56888, 1.78802, 35.0022, 52.2789, 14.7608, -3.78002, -41.3854, -45.1105, -37.1508, -61.2789, -62.3907, -88.5223, -66.9645, -22.2997, -23.6928, -31.1954, -27.6457, -29.8597, -55.2358, -54.6584, -84.6694, -96.2186, -53.0046, -61.9071, -34.0504, 38.6568, 14.619, -74.7164, -78.2062, -66.9192, -70.9812, -79.3468, -79.0291, -46.7413, 56.5728, 86.8947, 22.5091, -21.8219, -33.4546, -14.3868, -35.3267, -23.5025, 21.3056, -70.8408, -68.1742, -34.5951, -41.1257, -45.7788, -38.1253, -31.3488, -23.7545, -53.3011, -84.1301, -86.4792, -12.9146, -24.5203, -1.3178, 29.3487, 16.0324, -2.69494, -7.48822, -11.4777, -13.8073, -10.2985, -5.98846, 5.36852, 38.6518, 39.0492, 11.6808, -15.6958, -71.3845, -92.2402, -59.2197, -1.45392, 10.3941, -66.8128, -72.2761, -45.7584, -43.2882, -46.7248, -42.129, -36.4557, 2.26342, -38.2171, -41.8484, -93.7834, -44.9034, -57.1382, -36.659, 41.0467, 30.2665, 37.1989, 31.0552, 31.7124, 33.2096, 42.646, 52.8339, 45.0443, 32.2437, 42.675, 44.2461, 19.6885, -51.1333, -73.0236, -52.0377, -29.0787, -9.18726, -49.4132, -58.7842, -55.2863, -66.7477, -77.0397, -84.4213, -76.7451, -12.9138, -65.2053, -95.6635, -108.224, -89.0034, -70.7463, -41.8601, 27.6238, 27.4168, 36.8131, 6.28526, -35.3643, -31.096, -15.8045, 6.22104, 26.2883, 28.4448, 54.7693, 53.1491, 7.39914, -32.5416, -28.5746, -52.5908, -70.4618, -38.5692, -59.6761, -75.0039, -85.4018, -100.706, -111.009, -117.261, -110.479, -59.5411, -74.5924, -75.7989, -52.0521, -31.3376, -10.6484, -4.2858, 21.0522, 22.3467, 30.2432, 9.3779, -93.661, -116.714, -111.665, -57.6494, -0.655418, -15.5873, -24.4671, -32.3349, -62.2397, -94.2392, -104.365, -105.358, -91.1983, -88.2712, -105.365, -119.552, -119.82, -116.994, -104.09, -81.0803, -62.0799, -36.1054, -13.041, 1.04266, 4.148, 7.30292, 8.38258, 7.1497, 54.4462, 4.14642, -37.5814, -33.8775, 5.73262, 46.2197, 75.845, 79.4773, 20.9858, -25.2914, -37.51, -33.659, -18.8157, -8.80779, 53.2231, 93.2814, 75.4193, 26.4453, 20.4258, 12.5272, -32.2094, -52.177, -59.1076, -55.928, -65.6245, -73.3362, -79.9384, -61.3761, -48.8426, -61.4408, -61.0004, -61.8925, 37.6359, 23.5344, -13.1023, 0.800873, 41.4655, 42.9765, 67.6238, 63.2884, 3.89973, -31.3913, -13.7009, 22.1709, 52.9996, 80.9861, 104.03, 111.226, 105.321, 101.293, 95.3131, 86.3268, 2.53662, -48.4856, -49.396, -46.1962, -46.8113, -55.5073, -72.0158, -55.5526, -51.1964, -52.9002, -68.4992, -69.451, 33.7486, 19.9808, -17.4759, 29.4451, 32.2632, 23.9262, 59.5955, 61.2341, 43.8031, 57.5054, 85.1798, 105.991, 102.955, 109.92, 110.009, 109.209, 95.2332, 90.2362, 100.313, 110.397, 46.5497, -34.4245, -39.349, -49.0985, -31.7413, -44.4301, -76.0637, -59.7801, -54.5633, -65.294, -74.0653, -74.2236, 25.7469, 18.1227, -7.14597, 10.7771, 38.8009, 69.7037, 95.4687, 101.044, 95.5359, 87.2173, 68.0058, 65.8295, 59.9022, 12.844, 54.8419, 108.068, 96.1581, 77.1768, 66.2797, 74.3363, 62.5454, -5.33781, -42.2986, -37.097, -40.8271, -62.5995, -73.3383, -48.2278, -58.1774, -64.0082, -74.8449, -69.1779, 15.737, 25.2434, 15.1592, 63.1952, 100.412, 96.3217, 68.1749, 57.911, 41.5346, 22.3328, 5.03908, 25.834, 18.9612, -68.0606, 16.8828, 117.12, 105.242, 105.184, 85.1403, 72.2951, 18.6611, 3.85042, -26.1157, -27.0425, -42.9313, -60.849, -53.7108, -52.6362, -76.6718, -66.6398, -69.6471, -53.1156, 21.7426, 39.3518, 38.5349, 55.7289, 48.0338, 36.0099, 12.9913, 13.9977, 11.722, 5.52066, -0.777, 32.0191, -2.74036, -59.7763, 5.14406, 86.3383, 106.457, 110.284, 111.157, 111.342, 45.5835, -8.23832, -3.25398, -23.1968, -43.1872, -61.2976, -55.2369, -48.1509, -70.2363, -68.2919, -54.4229, -44.9889, 45.9443, 43.6761, 14.9781, -3.63592, 0.662018, -4.17794, -15.1087, -17.0277, -31.2016, -45.3906, -57.5663, -39.6497, -26.4129, -18.3927, 1.4973, 24.5635, 57.6588, 95.4937, 110.378, 114.494, 54.5825, -21.2155, -19.1547, -28.2627, -54.3404, -67.5791, -54.6699, -59.6459, -54.7771, -51.9002, -57.1203, -53.7987, 67.22, 31.0792, -16.5265, -23.0204, -39.6083, -61.4736, -63.3489, -75.121, -83.1406, -78.2961, -56.3665, -22.3107, 24.9532, 27.9062, -29.2193, -2.16368, 23.7316, 40.5549, 81.507, 115.623, 77.7272, 29.8028, -0.196899, -9.43016, -28.4999, -38.7498, -43.0376, -69.1287, -62.2781, -40.4143, -51.7504, -61.5283, 14.5307, -19.4543, -54.0301, -64.4674, -53.0475, -27.8232, 16.3899, 7.79326, -3.09348, 19.7973, 52.836, 74.8073, 63.9121, 30.8791, -57.217, -46.336, -0.550842, 66.2939, 74.2371, 117.29, 73.4978, -25.4495, 22.3844, 38.1596, -23.9878, -51.2585, -55.5052, -73.7386, -80.7836, -44.9264, -52.3336, -71.2327, -53.4231, -12.3085, -7.76716, -9.15446, 28.2671, 56.6102, 59.8569, 51.41, 31.6292, 39.6197, 70.687, 83.5553, 58.4763, 28.4741, -56.5404, -61.6459, -25.9226, 84.9255, 116.725, 120.733, 64.9735, -71.9099, -25.9463, 45.8154, 11.4641, -36.9246, -69.1286, -60.3957, -53.4243, -46.6402, -68.0992, -80.1413, -72.3685, 24.7919, 46.377, 47.047, 61.558, 48.8475, 31.1697, 38.6395, 30.0236, 39.2887, 65.1816, 76.0852, 51.1059, 28.0386, -35.0413, -46.144, -13.2792, 85.4838, 117.24, 122.257, 80.3977, -41.4762, -25.427, 35.3235, 45.9667, 28.5212, -41.747, -58.9239, -26.0764, -34.3496, -41.8135, -57.0275, -53.2953, 26.0272, 25.6958, 42.4012, 60.8221, 50.009, 45.3647, 46.8465, 37.4061, 40.7355, 56.6156, 70.5068, 46.4123, 33.2977, -7.74746, -25.9024, 5.01876, 89.8541, 108.639, 119.701, 85.8607, -34.019, -18.136, 23.6375, 13.3183, 33.9791, 30.712, -1.52946, -7.73564, -29.042, -42.5374, -39.908, -19.1401, 29.2282, 16.0533, 31.8269, 64.2133, 57.2573, 56.4955, 44.9404, 40.5394, 48.8083, 64.7597, 85.5264, 55.4733, 38.4234, -10.6385, -22.7404, 15.129, 91.0909, 105.954, 117.969, 90.2367, -30.6795, -29.8508, 22.8534, 16.5414, 12.3364, 30.0662, 45.7716, 14.5323, -30.7806, -52.4191, -45.8295, -14.9153, 26.5247, 4.32312, 26.9986, 47.358, 40.3503, 27.6261, 28.0635, 35.4788, 59.5937, 76.5708, 95.3561, 71.4206, 52.521, 16.4598, -8.5709, 6.43364, 86.393, 108.283, 117.322, 94.3475, -12.6601, -22.6764, 19.9658, 26.8031, 25.6749, 15.3573, 19.2421, 40.0002, 22.6192, -48.1837, -64.7118, -19.9477, 21.7059, 5.49316, 29.0475, 64.2771, 73.4669, 75.8089, 60.1249, 45.3188, 55.5218, 95.668, 124.629, 127.589, 111.649, 78.7053, 56.8479, 64.9545, 101.976, 115.752, 118.615, 95.5464, -1.35186, -15.2826, 21.4937, 30.3147, 23.1621, 28.9472, 18.8065, 17.4799, 37.9524, 23.1017, -46.6528, 31.7551, 81.53, 55.4504, 74.1299, 109.515, 131.849, 133.055, 117.184, 107.595, 108.974, 120.308, 134.339, 143.187, 123.28, 59.3309, 89.6136, 121.742, 116.727, 119.48, 116.24, 98.272, 4.44858, -14.6773, 19.1841, 33.9772, 25.7323, 32.4139, 15.2133, 19.7544, 23.172, 34.3102, 7.30038, 72.4561, 129.349, 118.468, 133.342, 133.949, 135.373, 140.562, 142.759, 143.361, 143.654, 141.891, 137.981, 139.878, 115.92, 91.1971, 102.593, 108.726, 112.771, 116.636, 115.483, 99.3641, 7.42142, -13.7614, 12.0255, 31.8014, 28.4025, 36.0443, 6.71884, -22.8857, 25.3708, 22.2695, 9.00884, 84.153, 137.269, 135.641, 139.735, 140.439, 141.93, 143.11, 142.351, 140.929, 140.285, 142.499, 137.645, 139.682, 119.678, 111.099, 109.481, 113.819, 115.981, 115.848, 116.597, 102.303, 14.1286, -13.0833, 7.67538, 30.4933, 33.1299, 39.7246, 11.2693, -30.5335, 3.50442, 30.1928, 8.7706, 102.727, 143.074, 133.789, 131.086, 125.91, 115.474, 109.686, 104.806, 103.23, 98.6368, 92.917, 83.0297, 70.2784, 68.4243, 83.8239, 100.107, 120.485, 126.694, 120.57, 116.285, 100.035, 23.6816, -17.5426, -2.83632, 25.9882, 31.7141, 34.3374, 19.7818, -6.16302, -6.42202, 26.9372, 20.3323, 30.2721, 45.7943, 24.7404, 6.22434, 7.30584, 2.02918, -20.763, -21.6278, 0.597717, 20.0646, 24.3091, 8.33978, -32.3689, -44.0328, -12.6483, -7.46966, 11.781, 41.9071, 65.7226, 92.5158, 93.3566, 30.0098, -2.25052, 1.51134, 23.2993, 28.9465, 33.5863, 40.9204, 26.8105, 22.3819, 27.4775, 34.758, -27.3775, 15.4249, 5.4544, -57.9036, -28.7121, -8.81336, -43.5222, -46.3856, -4.22458, 19.2015, -3.40582, 53.7211, 52.826, 45.0656, 49.451, 18.7368, -16.1688, -36.2468, -24.2913, 56.3902, 94.0935, 32.9419, 27.8496, 30.6348, 31.2925, 29.7403, 31.4251, 38.7407, 35.5967, 36.0126, 27.8352, 35.054, 66.8022, 107.856, 85.9422, -39.4069, 0.895622, 3.88258, -28.6784, -37.5099, 33.7264, 56.0583, 37.2474, 122.587, 131.771, 123.889, 124.238, 122.521, 114.518, 96.4386, 70.4569, 84.075, 75.6284, -3.34378, -11.419, -33.6985, 17.9677, 43.4046, 39.0795, 45.5356, 41.2842, 35.4058, 24.9839, 33.0068, 68.9398, 64.0616, 42.2449, -40.0883, -4.76102, -14.6908, -27.0757, -31.755, 21.5414, 33.755, 4.82186, 50.1411, 37.3833, 22.5059, 36.7339, 54.9589, 62.0049, 35.9528, 62.8464, 92.458, 11.0591, -48.9733, -54.0976, -77.25, -46.5369, -10.0161, -0.448578, 14.0315, 20.5724, 23.5164, 24.1214, 40.1446, 44.9369, -26.09, -51.8986, -59.1053, -52.7378, -50.6203, -53.8735, -55.4182, -44.1112, -36.9502, 13.1283, 63.3277, 40.4561, 0.607323, -18.1798, -20.0503, -52.0179, -93.0722, -42.1934, 71.5538, -45.6789, -67.7984, -74.8839, -78.0662, -75.3185, -71.722, -77.2031, -74.8668, -69.3605, -66.4654, -36.8785, 48.2292, 69.7925, 6.59154, -26.1265, -26.3234, -23.8603, -20.7445, -20.9231, -9.43924, -1.14312, 25.9429, 97.0011, 107.234, 80.3811, -6.4564, -53.2246, -21.1362, -50.1174, -83.1089, -82.1921, 33.5893, -4.49764, -28.6663, -11.8814, -6.26096, 2.46302, -28.9153, -65.3781, -89.2536, -91.6913, -92.7413, -65.0538, 49.168, 51.6391, 64.2625, 71.4082, 76.3018, 79.8592, 82.9818, 81.7351, 85.1955, 82.4636, 72.6217, 63.7572, 58.9684, 41.1699, -41.5904, -77.2268, -27.2341, -42.2424, -73.1995, -80.3233, -26.735, 18.1943, 22.0144, 25.598, 32.1861, 18.8642, -41.5366, -51.9875, -70.9961, -84.4558, -54.3909, -58.4895, -4.98102, 58.5305, 55.8828, 14.7783, 33.5473, 55.105, 51.2322, 35.9365, 28.4166, 23.6717, 49.8755, 63.1131, 33.4592, 26.7209, -18.0234, -25.7979, -11.816, -35.8976, -43.9778, -72.0669, -42.4242, 6.3838, 5.11892, -0.30172, 6.31234, 3.05826, -31.3973, -41.9177, -74.9443, -80.4295, -23.1857, -31.0545, -5.27678, 56.4333, 39.4805, -52.8137, -59.2893, -48.972, -51.959, -60.274, -57.9225, -28.6355, 64.6837, 90.971, 34.4565, 5.97172, -11.7713, 5.2637, -6.6832, 7.1757, 46.0288, -48.1061, -37.3958, -2.70824, -11.1143, -14.6716, -5.96, 0.785759, 1.31926, -38.3113, -73.1987, -70.5299, 14.05, 0.410362, 20.444, 46.1436, 40.9395, 22.307, 12.5799, 9.66712, 8.44034, 12.0053, 18.3294, 28.6902, 53.9714, 51.3084, 28.8569, 12.3708, -47.3745, -68.2546, -29.2641, 28.5495, 36.4072, -42.8046, -44.2339, -12.6255, -9.0315, -13.4187, -9.7845, -5.1116, 28.5652, -19.9909, -29.7379, -79.6935, -25.8184, -38.152, -18.8881, 51.8579, 48.2211, 59.2646, 53.2178, 55.9819, 62.5712, 72.0533, 78.2625, 66.5166, 52.7126, 63.0745, 65.5829, 45.9576, -24.8747, -46.7842, -24.838, -3.8444, 13.0642, -28.1631, -39.5285, -29.9864, -38.3545, -50.6284, -60.984, -51.2873, 13.5134, -44.8681, -80.4273, -96.0302, -74.8709, -54.7512, -22.1055, 13.351, 17.3066, 29.8319, 15.4347, -16.0524, -6.6856, 9.65252, 26.7356, 41.8599, 44.0101, 69.278, 69.6096, 25.8297, -14.0867, -10.1184, -34.1745, -48.0218, -15.1387, -38.2648, -57.5837, -65.9442, -80.2431, -92.5438, -101.784, -91.0046, -34.085, -53.2086, -59.5272, -38.8781, -16.2564, 7.28158, 17.3937, 4.55436, 8.0288, 19.0594, 11.3446, -81.5207, -101.46, -94.3431, -43.2556, 8.82656, -6.09936, -14.0079, -21.882, -50.7581, -82.7129, -92.8297, -91.8564, -70.7057, -64.8184, -84.9299, -102.122, -102.376, -101.572, -91.7082, -71.7163, -46.7353, -12.7785, 8.1868, 19.1359, 22.1222, 25.1694, 28.0938, 29.6181};
			int[] pixels = new int[floatPixels.length] ;
			for (int j = 0; j < pixels.length/3; j++) {
				pixels[j * 3] = (int) (floatPixels[j]);
				pixels[j * 3 + 1] = (int) (floatPixels[pixels.length/3 + j]);
				pixels[j * 3 + 2] = (int) (floatPixels[2 * pixels.length/3 + j]);
			}
			
			BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_3BYTE_BGR);
//          try {
//				image = ImageIO.read(new File("/home/jxchang/project/datasets/LFW/lfw-deepfunneled/AJ_Cook/AJ_Cook_0001.jpg"));
//			} catch (IOException e) {
//				// TODO Auto-generated catch block
//				e.printStackTrace();
//			}
			Image images = image.getScaledInstance(128, 128, Image.SCALE_SMOOTH);
            WritableRaster raster =  image.getRaster();
            raster.setPixels(0,0,width,height,pixels);

            imageLabel.setIcon(new ImageIcon(images));
            
            float[] label = cp.getNextBatchLabel();
			for (int j = 0; j < 10; j++) {
				if (label[j] == 1){
					type.setText(""+labels[j]);
					break;
				}
			}  

			System.out.printf("%d %s \n%s \n", pixels.length,Arrays.toString(floatPixels),Arrays.toString(label));           
    		try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	}
	
	
	@Test
	public void CNNdemo() {
		boolean useOpenCL = true;
		boolean addBias = true;
		boolean padding = true;
		Logger logger = Logger.getLogger("CIFAR-10 demo with CNN");
		
		JFrame frame = new JFrame();
		frame.setMinimumSize(new Dimension(384, 384));
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.getContentPane().setLayout(null);
        JLabel imageLabel = new JLabel();
        JLabel type = new JLabel("");
        JLabel pred = new JLabel("");
        JLabel correctCnt = new JLabel("");
        JLabel wrongCnt = new JLabel("");
        JButton plusBtn = new JButton("+");
        JButton minusBtn = new JButton("-");
        plusBtn.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				interval /=2;
			}});
        minusBtn.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				interval *=2;
			}});        

		frame.getContentPane().add(imageLabel);
		frame.getContentPane().add(type);
		frame.getContentPane().add(pred);
		frame.getContentPane().add(correctCnt);
		frame.getContentPane().add(wrongCnt);
		frame.getContentPane().add(plusBtn);
		frame.getContentPane().add(minusBtn);

		imageLabel.setBounds(128, 80, 128, 128);
		type.setBounds(128, 208, 240, 16);
		pred.setBounds(128, 230, 240, 16);
		correctCnt.setBounds(128, 280, 120, 16);
		wrongCnt.setBounds(128, 302, 120, 16);
		plusBtn.setBounds(280, 280, 60, 16);
		minusBtn.setBounds(280, 302, 60, 16);

		int[][] cnnLayers = new int[][] {	{3, 0, 0 ,0}, 
				{32, 5, 5, 1},
				{3, 3, 2}, 
				{32, 5, 5, 1},
				{3, 3, 2}, 
				{64, 5, 5, 1}, 
				{3, 3, 2}, 
				{64},
				{10}
				};
		ConvolutionalNeuralNetwork cnn = new ConvolutionalNeuralNetwork(cnnLayers, addBias, padding, useOpenCL); 
		cnn.setInputShape(new int[] {32, 32});
		Layer l1 = cnn.getInputLayer();
		ConvolutionalLayer l2 = (ConvolutionalLayer) l1.getNextLayer();
		PoolingLayer l3 = (PoolingLayer) l2.getNextLayer();
		ConvolutionalLayer l4 = (ConvolutionalLayer) l3.getNextLayer();
		PoolingLayer l5 = (PoolingLayer) l4.getNextLayer();
		ConvolutionalLayer l6 = (ConvolutionalLayer) l5.getNextLayer();
		PoolingLayer l7 = (PoolingLayer) l6.getNextLayer();
		FullyConnectedLayer l8 = (FullyConnectedLayer) l7.getNextLayer();
		FullyConnectedLayer l9 = (FullyConnectedLayer) l8.getNextLayer();
		l2.setActivationType(ActivationType.RELU);
		l4.setActivationType(ActivationType.RELU);
		l6.setActivationType(ActivationType.RELU);
		l8.setActivationType(ActivationType.NONE);
		l9.setActivationType(ActivationType.NONE);
		l3.setPoolingType(PoolingType.MAX);
		l5.setPoolingType(PoolingType.AVER);
		l7.setPoolingType(PoolingType.AVER);
		String weightsPath = "/home/jxchang/project/records/cifar/cnnReLU10.weights";
		cnn.loadWeights(weightsPath);
		
		CIFAR10DataProvider cp1 = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", 10000, DatasetType.TEST, false);
		cnn.test(cp1);
		
		
		CIFAR10DataProvider cp = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", 1, DatasetType.TEST, false, false);
//		CIFAR10DataProvider cp2 = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", 1, DatasetType.TRAINING_ALL, false);
		int width = 32;
		int height = 32;
		String[] labels= {"airplane", 
				"automobile",
				"bird",
				"cat",
				"deer",
				"dog",
				"frog",
				"horse",
				"ship", 
				"truck"};
		
		
		imageLabel.setVisible(true);
		type.setVisible(true);
		pred.setVisible(true);
		frame.getContentPane().setVisible(true);
		frame.setVisible(true);
		plusBtn.setVisible(true);
		minusBtn.setVisible(true);

		float[] predictions = cnn.getOutputLayer().getActivations();
		int cnt1 = 0, cnt2 = 0;
		for (int i = 0; i < cp.getDatasetSize(); i ++) {
			float[] floatPixels = cp.getNextbatchInput();
			int[] pixels = new int[floatPixels.length] ;
			for (int j = 0; j < pixels.length/3; j++) {
				pixels[j * 3] = (int) (floatPixels[j]);
				pixels[j * 3 + 1] = (int) (floatPixels[pixels.length/3 + j]);
				pixels[j * 3 + 2] = (int) (floatPixels[2 * pixels.length/3 + j]);
			}
			
			BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_3BYTE_BGR);

			Image images = image.getScaledInstance(128, 128, Image.SCALE_SMOOTH);
            WritableRaster raster =  image.getRaster();
            raster.setPixels(0,0,width,height,pixels);

            imageLabel.setIcon(new ImageIcon(images));
            
            float[] label = cp.getNextBatchLabel();
            int lableInd = 0;
			for (int j = 0; j < 10; j++) {
				if (label[j] == 1){
					type.setText("label:          "+labels[j]);
					lableInd = j;
					break;
				}
			}  
			int maxInd = 0;
			for (int j = 0; j < 9; j++) {
				if (predictions[i * 10 + maxInd] < predictions[i * 10 + j + 1]) {
					maxInd = j + 1;
				}
			}  
			pred.setText("prediction: "+labels[maxInd]);
			if (lableInd == maxInd) {
				cnt1++;
			} else {
				cnt2++;
			}
			correctCnt.setText("correct: " + cnt1);
			wrongCnt.setText("error: " + cnt2);

    		try {
				Thread.sleep(interval);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		while(true);
	}
	
	@Test
	public void TrainCNNReLU() {
		boolean useOpenCL = true;
		boolean addBias = true;
		boolean padding = true;
		int batchSize = 100;
		String p = Paths.get(System.getProperty("user.dir"), "..", "..", "..","datasets", "CIFAR", "cifar-10-batches-bin").toString();

		CIFAR10DataProvider trainingSet = new CIFAR10DataProvider(p, batchSize, DatasetType.TRAINING_ALL, false);
		CIFAR10DataProvider TestSet = new CIFAR10DataProvider(p, batchSize, DatasetType.TEST, false);
		int costType = 0; 
		float baselearningRate = 0.002f;
		float momentum = 0.9f;
		float weightDecay = 0.4f;//0.4f;//0.01f;
		int lrChangeCycle = 8 * trainingSet.getDatasetSize()/trainingSet.getBatchSize();
		float lrChangeRate = 0.1f;
		int epoch = 10;
		int[][] cnnLayers = new int[][] {	{3, 0, 0 ,0}, 
											{32, 5, 5, 1},
											{3, 3, 2}, 
											{32, 5, 5, 1},
											{3, 3, 2}, 
											{64, 5, 5, 1}, 
											{3, 3, 2}, 
											{64},
											{10}
											};
		ConvolutionalNeuralNetwork cnn = new ConvolutionalNeuralNetwork(cnnLayers, addBias, padding, useOpenCL); 
		cnn.setInputShape(new int[] {32, 32});
		Layer l1 = cnn.getInputLayer();
		ConvolutionalLayer l2 = (ConvolutionalLayer) l1.getNextLayer();
		PoolingLayer l3 = (PoolingLayer) l2.getNextLayer();
		ConvolutionalLayer l4 = (ConvolutionalLayer) l3.getNextLayer();
		PoolingLayer l5 = (PoolingLayer) l4.getNextLayer();
		ConvolutionalLayer l6 = (ConvolutionalLayer) l5.getNextLayer();
		PoolingLayer l7 = (PoolingLayer) l6.getNextLayer();
		FullyConnectedLayer l8 = (FullyConnectedLayer) l7.getNextLayer();
		FullyConnectedLayer l9 = (FullyConnectedLayer) l8.getNextLayer();
		l2.setActivationType(ActivationType.RELU);
		l4.setActivationType(ActivationType.RELU);
		l6.setActivationType(ActivationType.RELU);
		l8.setActivationType(ActivationType.NONE);
		l9.setActivationType(ActivationType.NONE);
		l3.setPoolingType(PoolingType.MAX);
		l5.setPoolingType(PoolingType.AVER);
		l7.setPoolingType(PoolingType.AVER);
		
		l2.initializeWeights(0.0001f, 0);
		l4.initializeWeights(0.01f, 0f);
		l6.initializeWeights(0.01f, 0);
		l8.initializeWeights(0.1f, 0);
		l9.initializeWeights(0.1f, 0);		

//		l2.setLearningRateMultiplication(0.01f);
//		l4.setLearningRateMultiplication(1);
//		l6.setLearningRateMultiplication(10);
//		l8.setLearningRateMultiplication(10);
//		l9.setLearningRateMultiplication(100);
		
		Logger logger = Logger.getLogger("CIFAR10 traing with CNN");
		logger.log(Level.INFO, "CNN architecture: \n"
				+ "{0} {1} bias \n"
				+ "conv layer activation type: {2}\n"
				+ "fully layer activation type: {3}"
				, new Object[] {Arrays.deepToString(cnnLayers), addBias ? "with" : "without", ActivationType.RELU, ActivationType.RELU});

		logger.log(Level.INFO, "Traning configuration: \n"
				+ "useOpenCL = {0} \n"
				+ "batchSize = {1} \n"
				+ "costType = {2} \n"
				+ "epoch = {3} \n"
				+ "baselearningRate = {4} \n"
				+ "momentum = {5} \n"
				+ "weightDecay = {6} \n"
				+ "lrChangeCycle = {7} \n"
				+ "lrChangeRate = {8} \n", new Object[] {useOpenCL, batchSize, (costType==0?"CE":"MSE"), epoch, baselearningRate+"", momentum, weightDecay, lrChangeCycle, lrChangeRate});
		String path = "/home/jxchang/project/records/cifar/.cnnReLU.weights";

		
		logger.log(Level.INFO, "Pretest before training...");
//		cnn.test(TestSet);
//		cnn.loadWeights(path);
		cnn.test(TestSet);
			
		cnn.train(trainingSet, costType, baselearningRate, momentum, weightDecay, lrChangeCycle, lrChangeRate, epoch);

		cnn.test(trainingSet);
		
//		logger.log(Level.INFO, "Saving weights...");
//		cnn.saveWeights(path);

		float errorRate = cnn.test(TestSet);
		assertEquals(0, errorRate, 0.1);	

	}
	
	
//	@Test
//	public void TrainMLP() {
//		boolean useOpenCL = true;
//		boolean addBias = true;
//		int batchSize = 64;
//		CIFAR10DataProvider trainingSet = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", batchSize, DatasetType.TRAINING_ALL, false);
//		CIFAR10DataProvider TestSet = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", 10000, DatasetType.TEST, false);
//		int costType = 0; //cross entropy
//		float baselearningRate = 0.02f;
//		float momentum = 0.9f;
//		float weightDecay = 0.05f;
//		int lrChangeCycle = 0;//10 * trainingSet.getDatasetSize()/trainingSet.getBatchSize();
//		float lrChangeRate = 0.33f;
//		int epoch = 20;
//		int[] mlpLayers = new int[]{3072, 1024, 512 ,10};
//		NeuralNetwork mlp = new MultiLayerPerceptron(mlpLayers, addBias, useOpenCL); 
//		
//		Logger logger = Logger.getLogger("CIFAR10 traing with MLP");
//		logger.log(Level.INFO, "MLP architecture: \n"
//				+ "{0} {1} bias \n", new Object[] {Arrays.toString(mlpLayers), addBias ? "with" : "without"});
//
//		logger.log(Level.INFO, "Traning configuration: \n"
//				+ "useOpenCL = {0} \n"
//				+ "batchSize = {1} \n"
//				+ "costType = {2} \n"
//				+ "epoch = {3} \n"
//				+ "baselearningRate = {4} \n"
//				+ "momentum = {5} \n"
//				+ "weightDecay = {6} \n"
//				+ "lrChangeCycle = {7} \n"
//				+ "lrChangeRate = {8} \n", new Object[] {useOpenCL, batchSize, (costType==0?"CE":"MSE"), epoch, baselearningRate, momentum, weightDecay, lrChangeCycle, lrChangeRate});
//		
////		mlp.test(trainingSet);
//		mlp.test(TestSet);
//		
//		logger.log(Level.INFO, "Training start...");
//		mlp.train(trainingSet, costType, baselearningRate, momentum, weightDecay, lrChangeCycle, lrChangeRate, epoch);
//
//		logger.log(Level.INFO, "Saving weights...");
//		String path = "/home/jxchang/project/records/cifar/.mlp.weights";
//		mlp.saveWeights(path);
//		logger.log(Level.INFO, "Weights saved to " + path);
//
//		mlp.test(trainingSet);
////		System.out.println("Test with test set...");
//		float errorRate = mlp.test(TestSet);
//		assertEquals(0, errorRate, 0.1);		
//	}
	

//	@Test
//	public void TrainCNN() {
//		boolean useOpenCL = true;
//		boolean addBias = true;
//		boolean padding = true;
//		int batchSize = 100;
//		CIFAR10DataProvider trainingSet = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", batchSize, DatasetType.TRAINING_ALL, false);
//		CIFAR10DataProvider TestSet = new CIFAR10DataProvider("/home/jxchang/project/datasets/CIFAR/cifar-10-batches-bin", batchSize, DatasetType.TEST, false);
//		int costType = 0; 
//		float baselearningRate = 0.005f;
//		float momentum = 0.9f;
//		float weightDecay = 0;//0.01f;
//		int lrChangeCycle = 5 * trainingSet.getDatasetSize()/trainingSet.getBatchSize();
//		float lrChangeRate = 0.33f;
//		int epoch = 1;
//		int[][] cnnLayers = new int[][] {	{3, 0, 0 ,0}, 
//											{32, 5, 5, 1},
//											{2, 2, 2}, 
//											{32, 5, 5, 1},
//											{2, 2, 2}, 
//											{64, 5, 5, 1}, 
//											{2, 2, 2}, 
//											{64},
//											{10}
//											};
//		ConvolutionalNeuralNetwork cnn = new ConvolutionalNeuralNetwork(cnnLayers, addBias, padding, useOpenCL); 
//		cnn.setInputShape(new int[] {32, 32});
//		Layer l1 = cnn.getInputLayer();
//		Layer l2 = l1.getNextLayer();
//		PoolingLayer l3 = (PoolingLayer) l2.getNextLayer();
//		Layer l4 = l3.getNextLayer();
//		PoolingLayer l5 = (PoolingLayer) l4.getNextLayer();
//		Layer l6 = l5.getNextLayer();
//		PoolingLayer l7 = (PoolingLayer) l6.getNextLayer();
//		Layer l8 = l7.getNextLayer();
//		Layer l9 = l8.getNextLayer();
//		l2.setActivationType(ActivationType.TANH);
//		l4.setActivationType(ActivationType.TANH);
//		l6.setActivationType(ActivationType.TANH);
//		l8.setActivationType(ActivationType.TANH);
//		l9.setActivationType(ActivationType.TANH);
//		l3.setPoolingType(PoolingType.MAX);
//		l5.setPoolingType(PoolingType.AVER);
//		l7.setPoolingType(PoolingType.AVER);
//		
//		Logger logger = Logger.getLogger("CIFAR10 traing with CNN");
//		logger.log(Level.INFO, "CNN architecture: \n"
//				+ "{0} {1} bias \n"
//				+ "conv layer activation type: {2}\n"
//				+ "fully layer activation type: {3}"
//				, new Object[] {Arrays.deepToString(cnnLayers), addBias ? "with" : "without", ActivationType.TANH, ActivationType.TANH});
//
//		logger.log(Level.INFO, "Traning configuration: \n"
//				+ "useOpenCL = {0} \n"
//				+ "batchSize = {1} \n"
//				+ "costType = {2} \n"
//				+ "epoch = {3} \n"
//				+ "baselearningRate = {4} \n"
//				+ "momentum = {5} \n"
//				+ "weightDecay = {6} \n"
//				+ "lrChangeCycle = {7} \n"
//				+ "lrChangeRate = {8} \n", new Object[] {useOpenCL, batchSize, (costType==0?"CE":"MSE"), epoch, baselearningRate, momentum, weightDecay, lrChangeCycle, lrChangeRate});
//
//		
////		System.out.println(Arrays.toString(l2.getWeight()));
//		logger.log(Level.INFO, "Pretest before training...");
//		cnn.test(TestSet);
//		
//		String path = "/home/jxchang/project/records/cifar/.cnn.weights";
////		cnn.loadWeights(path);
////
////		cnn.test(TestSet);
//		
//		
//		cnn.train(trainingSet, costType, baselearningRate, momentum, weightDecay, lrChangeCycle, lrChangeRate, epoch);
////		System.out.println(Arrays.toString(l2.getWeight()));
//
//
//		cnn.test(trainingSet);
////		System.out.println("Test with test set...");
//		
////		cnn.saveWeights(path);
//
//		float errorRate = cnn.test(TestSet);
//		assertEquals(0, errorRate, 0.1);	
//		
//		logger.log(Level.INFO, "Saving weights...");
//
//	}
}
